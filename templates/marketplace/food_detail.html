{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container mt-5 mb-5">

    <div class="row">
        <!-- LEFT SIDE: Big Image -->
        <div class="col-md-6 text-center">
            <img src="{{ food.image.url }}" class="img-fluid" 
                 style="width: 100%; max-height: 450px; object-fit: cover; border-radius: 10px;">
        </div>

        <!-- RIGHT SIDE: Title + Price + Description + Add to Cart -->
        <div class="col-md-6">
            <h2>{{ food.food_title }}</h2>
            <h3 class="text-danger">$ {{ food.price }}</h3>

            <p class="mt-3"><h5>{{ food.description }}</h5></p>

            <a href="#" class="btn btn-danger btn-lg mt-3 w-50 add_to_cart_btn"
                data-id="{{ food.id }}"data-url="{% url 'add_to_cart' food.id %}">Add to Cart
            </a>

            <a href="{% url 'vendor_detail' vendor.vendor_slug %}" class="btn btn-secondary mt-3 w-50">
                Back to Menu
            </a>
        </div>
    </div>

    <hr class="mt-5">

    <!-- RELATED PRODUCTS -->
    <h4 class="mt-4">Related Food Items</h4>
    <div class="row mt-3">
        {% for item in related_foods %}
        <div class="col-md-3 mb-4">  
            <div class="card h-100 text-center shadow-sm">

                <img src="{{ item.image.url }}" class="card-img-top mx-auto mt-2"
                     style="width: 90px; height: 90px; object-fit: cover; border-radius: 5px;">

                <div class="card-body p-2">
                    <h6 class="card-title mb-1">{{ item.food_title|truncatechars:20 }}</h6>

                    <p class="text-danger mb-2">$ {{ item.price }}</p>

                    <a href="{% url 'food_detail' item.vendor.vendor_slug item.slug %}" 
                       class="btn btn-primary btn-sm w-100 mb-1">
                        View
                    </a>

                 
                </div>

            </div>
        </div>
        {% endfor %}
    </div>

</div>
<script>
    $(document).on('click', '.add_to_cart_btn', function (e) {
        e.preventDefault();
        
        let food_id = $(this).data('id');
        let add_url = $(this).data('url');

        $.ajax({
            type: "POST",
            url: add_url,
            data: {
                food_id: food_id,
                csrfmiddlewaretoken: "{{ csrf_token }}"
            },
            success: function (response) {
                if (response.status == "login_required") {
                    window.location.href = "/login/";
                } 
                else if (response.status == "success") {
                    // Update cart counter in navbar
                    $("#cart-counter").html(response.cart_counter);

                    Swal.fire({
                        icon: "success",
                        title: response.message,
                        timer: 800,
                        showConfirmButton: false
                    });
                }
            }
        });
    });
</script>

{% endblock %}
